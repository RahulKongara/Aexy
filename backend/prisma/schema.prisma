generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url = env("DATABASE_URL")
}

model User {
    id  String  @id @default(uuid()) @db.Uuid
    email   String  @unique @db.VarChar(255)
    password    String  @map("password_hash")
    tier    String  @default("FREE") @db.VarChar(20)
    createdAt   DateTime    @default(now()) @map("created_at")

    dailyUsage  DailyUsage[]
    subscriptions   Subscription[]
    conversations   Conversation[]

    @@map("users")
}

model DailyUsage {
    id  String  @id @default(uuid()) @db.Uuid
    userId  String  @map("user_id") @db.Uuid
    date    DateTime    @default(now()) @db.Date
    conversationsCt Int @default(0) @map("conversations_ct")

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([userId, date])
    @@map("daily_usage")
}

model Subscription {
    id  String  @id @default(uuid()) @db.Uuid
    userId  String  @map("user_id") @db.Uuid
    tier    String  @db.VarChar(20)
    status  String  @default("active") @db.VarChar(20)
    startDate   DateTime    @default(now()) @map("start_date")
    endDate DateTime?   @map("end_date")

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@map("subscriptions")
}

model Conversation {
    id  String  @id @default(uuid()) @db.Uuid
    userId  String  @map("user_id") @db.Uuid
    scenario    String? @db.VarChar(255)
    startTime   DateTime    @default(now()) @map("start_time")
    endTime DateTime?   @map("end_time")
    summary String? @db.Text
    feedback    String? @db.Text

    user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
    messages Msg[]

    @@map("conversations")
}

model Msg {
    id String @id @default(uuid()) @db.Uuid
    conId String @map("con_id") @db.Uuid
    sender String @db.VarChar(20)
    content String @db.Text
    timestamp DateTime @default(now())

    conversation Conversation @relation(fields: [conId], references: [id], onDelete: Cascade)

    @@map("messages")
}

